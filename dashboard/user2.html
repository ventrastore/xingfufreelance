<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Xingfu Portal</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <div id="toast" class="toast">Notifikasi</div>

    <div class="app-screen">
        <header style="padding: 45px 20px 10px;">
            <p id="tag" style="color: var(--accent); font-size: 11px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px;">Xingfu Freelance</p>
            <h1 id="title" style="font-size: 36px; font-weight: 900; letter-spacing: -1.5px;">Hi,rista ika</h1>
        </header>

        <div id="homeSec" class="section">
            <div class="premium-card">
                <p style="color: var(--text-muted); font-weight: 600; font-size: 14px;">Saldo Tersedia</p>
                <h2 id="balanceDisp" style="font-size: 45px; font-weight: 900; letter-spacing: -2px; margin: 5px 0 25px;">Rp 0</h2>
                <button class="btn-main" id="btnWdHome" onclick="nav('walletSec')">Tarik Dana</button>
            </div>

            <h3 style="margin: 30px 20px 12px; font-size: 18px; font-weight: 800;">Tugas Tersedia</h3>
            <div class="list-group" style="background:white; margin:0 15px; border-radius:22px; overflow:hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.02);">
                <div style="display:flex; align-items:center; padding:22px; border-bottom:0.5px solid #F2F2F7;">
                    <div style="flex:1;">
                        <p style="font-weight:700;">Like Stream Tiktok</p>
                        <p style="color:var(--text-muted); font-size:12px;">ID: #TASK-991</p>
                    </div>
                    <button class="req-btn" style="background:var(--accent); color:white; border:none; font-weight:700; padding:10px 18px; border-radius:12px; cursor:pointer;" onclick="requestInfo(this)">Minta</button>
                </div>
            </div>
        </div>

        <div id="walletSec" class="section" style="display:none;">
            <div class="premium-card">
                <h3 style="margin-bottom:5px; font-weight:800;">Withdrawal</h3>
                <p style="font-size: 12px; color: var(--text-muted); margin-bottom: 20px;">Minimal Tarik: Rp 50.000</p>
                <input type="number" id="wdAmt" placeholder="Jumlah (Min 50000)">
                <select id="wdBank">
                    <option value="">Pilih Bank/Metode</option>
                    <option>BCA</option>
                    <option>DANA</option>
                    <option>MANDIRI</option>
                </select>
                <input type="text" id="wdRek" placeholder="Nomor Rekening">
                <button class="btn-main" id="btnWdConfirm" onclick="processWD()">Konfirmasi</button>
            </div>
            
            <p style="padding: 10px 20px; color: var(--text-muted); font-weight: 700; font-size: 11px;">RIWAYAT</p>
            <div id="histList" style="background:white; margin:0 15px; border-radius:20px; overflow:hidden;">
                <div style="padding:30px; text-align:center; color:var(--text-muted); font-size:12px;">Belum ada riwayat transaksi.</div>
            </div>
        </div>

        <div id="profileSec" class="section" style="display:none;">
            <div style="background:white; margin:15px; border-radius:22px; overflow:hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.02);">
                <div class="info-row"><span style="color:var(--text-muted); font-size:13px;">Username</span><span id="pUser" style="font-weight:700;">-</span></div>
                <div class="info-row"><span style="color:var(--text-muted); font-size:13px;">Password</span><span id="pPass" onclick="showPass()" style="color:var(--accent); font-weight:700; cursor:pointer;">••••••••</span></div>
            </div>
            <div style="padding: 10px 15px;">
                <button onclick="logout()" style="width:100%; padding:16px; border-radius:18px; border:none; background:white; color:var(--danger); font-weight:800; cursor:pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.05);">Logout</button>
            </div>
        </div>

        <div class="tab-bar">
            <div class="tab-item active" onclick="nav('homeSec')"><svg fill="currentColor" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>Home</div>
            <div class="tab-item" onclick="nav('walletSec')"><svg fill="currentColor" viewBox="0 0 24 24"><path d="M21 18v1c0 1.1-.9 2-2 2H5c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2h14c1.1 0 2 .9 2 2v1h-9c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h9zm-9-2h10V8H12v8zm4-2.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>Wallet</div>
            <div class="tab-item" onclick="nav('profileSec')"><svg fill="currentColor" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>Profile</div>
        </div>
    </div>

    <script>
        // ==========================================
        // GANTI ANGKA SALDO DI BAWAH INI
        // ==========================================
        let saldoManual = 10000; 
        // ==========================================

        const u = JSON.parse(sessionStorage.getItem('currentUser'));
        
        // Cek Login
        if(!u) {
            window.location.href = '../index.html';
        } else {
            document.getElementById('pUser').innerText = "@" + u.username;
            document.getElementById('title').innerText = "Hi, " + u.nama.split(' ')[0];
        }

        // Ambil saldo dari memori sementara browser, jika tidak ada pakai saldoManual
        let saldoAktif = parseInt(sessionStorage.getItem('session_saldo')) || saldoManual;

        function refreshUI() {
            // Update teks saldo di layar
            document.getElementById('balanceDisp').innerText = "Rp " + saldoAktif.toLocaleString('id-ID');
            sessionStorage.setItem('session_saldo', saldoAktif);
            
            const btnWdHome = document.getElementById('btnWdHome');
            // Tombol mati/redup kalau saldo tidak cukup buat WD
            if(saldoAktif < 50000) { 
                btnWdHome.innerText = "Saldo Kurang"; 
                btnWdHome.style.opacity = "0.5"; 
            } else { 
                btnWdHome.innerText = "Tarik Dana"; 
                btnWdHome.style.opacity = "1"; 
            }
        }

        refreshUI();

        // Fungsi Tombol Minta
        function requestInfo(btn) {
            btn.innerHTML = '<span class="loading-dots">Meminta</span>';
            btn.style.pointerEvents = "none";
            setTimeout(() => {
                btn.innerHTML = 'Accept';
                btn.className = "btn-accepted";
                showToast("Berhasil meminta tugas.");
            }, 2000);
        }

        // Fungsi Withdraw
        function processWD() {
            const amt = parseInt(document.getElementById('wdAmt').value);
            const bank = document.getElementById('wdBank').value;
            const btn = document.getElementById('btnWdConfirm');

            if(!amt || amt < 50000) return showToast("Minimal Rp 50.000");
            if(amt > saldoAktif) return showToast("Saldo Tidak Cukup");
            if(!bank) return showToast("Pilih Bank");

            btn.innerText = "Memproses...";
            btn.disabled = true;

            setTimeout(() => {
                saldoAktif -= amt; // Potong angka
                refreshUI(); // Perbarui tampilan
                
                const hist = document.getElementById('histList');
                if(hist.innerText.includes("Belum ada")) hist.innerHTML = "";
                
                const row = document.createElement('div');
                row.className = "info-row";
                row.innerHTML = `<div><p style="font-weight:700;">${bank}</p><p style="font-size:11px; color:gray;">Berhasil</p></div><span style="color:red; font-weight:800;">-Rp ${amt.toLocaleString('id-ID')}</span>`;
                
                hist.prepend(row);
                btn.innerText = "Konfirmasi";
                btn.disabled = false;
                showToast("WD Berhasil!");
                setTimeout(() => nav('homeSec'), 1000);
            }, 2000);
        }

        // Navigasi Tab
        function nav(id) {
            document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
            document.getElementById(id).style.display = 'block';
            document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
            
            if(id === 'homeSec') document.querySelectorAll('.tab-item')[0].classList.add('active');
            else if(id === 'walletSec') document.querySelectorAll('.tab-item')[1].classList.add('active');
            else document.querySelectorAll('.tab-item')[2].classList.add('active');
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg; t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }

        function showPass() { 
            const p = document.getElementById('pPass'); 
            p.innerText = p.innerText === "••••••••" ? u.password : "••••••••"; 
        }

        function logout() { 
            if(confirm("Logout?")) { sessionStorage.clear(); window.location.href = '../index.html'; } 
        }
    </script>
</body>
</html>
