<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Xingfu Portal</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <div id="toast" class="toast">Notifikasi</div>

    <div class="app-screen">
        <header style="padding: 45px 20px 10px;">
            <p id="tag" style="color: var(--accent); font-size: 11px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px;">Xingfu Freelance</p>
            <h1 id="title" style="font-size: 36px; font-weight: 900; letter-spacing: -1.5px;">Hi Calvin</h1>
        </header>

        <div id="homeSec" class="section active">
            <div class="premium-card">
                <p style="color: var(--text-muted); font-weight: 600; font-size: 14px;">Saldo Tersedia</p>
                <h2 id="balanceDisp" style="font-size: 45px; font-weight: 900; letter-spacing: -2px; margin: 5px 0 25px;">Rp 0</h2>
                <button class="btn-main" id="btnWdHome" onclick="nav('walletSec')">Tarik Dana</button>
            </div>

            <h3 style="margin: 30px 20px 12px; font-size: 18px; font-weight: 800;">Tugas Berjalan</h3>
            <div class="list-group" style="background:white; margin:0 15px; border-radius:22px; overflow:hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.02);">
                <div style="display:flex; align-items:center; padding:22px; border-bottom:0.5px solid #F2F2F7;">
                    <div style="flex:1;"><p style="font-weight:700;">Like Stream Tiktok </p><p style="color:var(--text-muted); font-size:12px;">ID: #TASK-991</p></div>
                    <button class="req-btn" style="background:var(--accent); color:white; border:none; font-weight:700; padding:10px 18px; border-radius:12px;" onclick="requestInfo(this)">Minta</button>
                </div>
                <div style="display:flex; align-items:center; padding:22px;">
                    <div style="flex:1;"><p style="font-weight:700;">Coment 20 video Tiktok</p><p style="color:var(--text-muted); font-size:12px;">ID: #TASK-992</p></div>
                    <button class="req-btn" style="background:var(--accent); color:white; border:none; font-weight:700; padding:10px 18px; border-radius:12px;" onclick="requestInfo(this)">Minta</button>
                </div>
            </div>
        </div>

        <div id="walletSec" class="section" style="display:none;">
            <div class="premium-card">
                <h3 style="margin-bottom:5px; font-weight:800;">Withdrawal</h3>
                <p style="font-size: 12px; color: var(--text-muted); margin-bottom: 20px;">Minimal Tarik: Rp 50.000</p>
                <input type="number" id="wdAmt" placeholder="Jumlah (Min 50000)">
                <select id="wdBank"><option value="">Pilih Bank/Metode</option><option>BCA</option><option>DANA</option><option>MANDIRI</option></select>
                <input type="text" id="wdRek" placeholder="Nomor Rekening">
                <button class="btn-main" id="btnWdConfirm" onclick="processWD()">Konfirmasi</button>
            </div>
            <p style="padding: 10px 20px; color: var(--text-muted); font-weight: 700; font-size: 11px;">RIWAYAT</p>
            <div id="histList" style="background:white; margin:0 15px; border-radius:20px; overflow:hidden;">
                <div style="padding:30px; text-align:center; color:var(--text-muted); font-size:12px;">Belum ada riwayat transaksi.</div>
            </div>
        </div>

        <div id="profileSec" class="section" style="display:none;">
            <div style="background:white; margin:15px; border-radius:22px; overflow:hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.02);">
                <div class="info-row"><span style="color:var(--text-muted); font-size:13px;">Username</span><span id="pUser" style="font-weight:700;">-</span></div>
                <div class="info-row"><span style="color:var(--text-muted); font-size:13px;">Password</span><span id="pPass" onclick="showPass()" style="color:var(--accent); font-weight:700; cursor:pointer;">••••••••</span></div>
                <div class="info-row"><span style="color:var(--text-muted); font-size:13px;">Lokasi</span><span id="pCity" style="font-weight:700;">-</span></div>
            </div>
            <div style="margin:25px 15px; background:white; border-radius:18px; padding:18px; text-align:center; cursor:pointer;" onclick="logout()">
                <span style="color:var(--danger); font-weight:800;">Logout</span>
            </div>
        </div>

        <div class="tab-bar">
            <div class="tab-item active" onclick="nav('homeSec')"><svg fill="currentColor" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>Home</div>
            <div class="tab-item" onclick="nav('walletSec')"><svg fill="currentColor" viewBox="0 0 24 24"><path d="M21 18v1c0 1.1-.9 2-2 2H5c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2h14c1.1 0 2 .9 2 2v1h-9c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h9zm-9-2h10V8H12v8zm4-2.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>Wallet</div>
            <div class="tab-item" onclick="nav('profileSec')"><svg fill="currentColor" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>Profile</div>
        </div>
    </div>

    <script>
        const u = JSON.parse(sessionStorage.getItem('currentUser'));
        if(!u) window.location.href = '../index.html';

        let saldo = parseInt(sessionStorage.getItem('saldo_' + u.username)) || 0;

        function refreshUI() {
            document.getElementById('balanceDisp').innerText = "Rp 10,000  " + saldo.toLocaleString('id-ID');
            sessionStorage.setItem('saldo_' + u.username, saldo);
            const btnWdHome = document.getElementById('btnWdHome');
            if(saldo < 50000) { btnWdHome.innerText = "Saldo Kurang"; btnWdHome.style.opacity = "0.6"; }
            else { btnWdHome.innerText = "Tarik Dana"; btnWdHome.style.opacity = "1"; }
        }

        document.getElementById('pUser').innerText = "@" + u.username;
        document.getElementById('pCity').innerText = u.kota;
        refreshUI();

        function requestInfo(btn) {
            btn.style.background = "#F2F2F7";
            btn.style.color = "var(--accent)";
            btn.innerHTML = '<span class="loading-dots">Meminta</span>';
            btn.style.pointerEvents = "none";
            setTimeout(() => {
                btn.innerHTML = 'Accept';
                btn.className = "btn-accepted";
                showToast("Permintaan terkirim.");
            }, 2500);
        }

        function processWD() {
            const amt = parseInt(document.getElementById('wdAmt').value);
            const bank = document.getElementById('wdBank').value;
            const btn = document.getElementById('btnWdConfirm');
            if(!amt || amt < 50000) return showToast("Minimal Rp 50.000");
            if(amt > saldo) return showToast("Saldo Tidak Cukup");

            btn.innerText = "Memproses...";
            setTimeout(() => {
                saldo -= amt; refreshUI();
                const hist = document.getElementById('histList');
                if(hist.innerText.includes("Belum ada")) hist.innerHTML = "";
                const row = document.createElement('div');
                row.className = "info-row";
                row.innerHTML = `<div><p style="font-weight:700; font-size:14px;">${bank}</p><p style="color:var(--text-muted); font-size:11px;">Berhasil</p></div><span style="color:var(--danger); font-weight:800;">-Rp ${amt.toLocaleString()}</span>`;
                hist.prepend(row);
                btn.innerText = "Konfirmasi";
                showToast("Berhasil ditarik!");
                setTimeout(() => nav('homeSec'), 1200);
            }, 2000);
        }

        function nav(id) {
            document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
            document.getElementById(id).style.display = 'block';
            document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
            const idx = id === 'homeSec' ? 0 : (id === 'walletSec' ? 1 : 2);
            document.querySelectorAll('.tab-item')[idx].classList.add('active');
            document.getElementById('title').innerText = id === 'homeSec' ? "Hi, " + u.nama.split(' ')[0] : (id === 'walletSec' ? "Wallet" : "Profile");
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg; t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }

        function showPass() { const p = document.getElementById('pPass'); p.innerText = p.innerText === "••••••••" ? u.password : "••••••••"; }
        function logout() { if(confirm("Keluar Sesi?")) { sessionStorage.clear(); window.location.href = '../index.html'; } }
    </script>
</body>
</html>